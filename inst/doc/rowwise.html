<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Row-wise iteration with slider</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Row-wise iteration with slider</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(slider)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(dplyr, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>{slider} is implemented with a new convention that began in {vctrs}, treating a data frame as a vector of rows. This makes <code>slide()</code> a <em>row-wise iterator</em> over a data frame, which can be useful in solving some long standing problem points in the tidyverse.</p>
<p>The point of this vignette is to go through a few examples of a row-oriented workflow. The examples are adapted from <a href="https://github.com/jennybc/row-oriented-workflows">Jenny Bryan’s talk of row-oriented workflows with purrr</a>, to show how this workflow is improved with <code>slide()</code>.</p>
<div id="row-wise-iteration" class="section level2">
<h2>Row-wise iteration</h2>
<p>Let’s first explore using <code>slide()</code> as a row wise iterator in general. We’ll start with this simple data frame.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>example &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,</span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="dt">y =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</span>
<span id="cb2-4"><a href="#cb2-4"></a>)</span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a>example</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt; # A tibble: 4 x 2</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt;       x y    </span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#&gt; 1     1 a    </span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#&gt; 2     2 b    </span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt; 3     3 c    </span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt; 4     4 d</span></span></code></pre></div>
<p>If we were to pass the <code>x</code> column to <code>slide()</code>, it would iterate over that using the window specified by <code>.before</code>, <code>.after</code>, and <code>.complete</code>. The defaults look to be similar to <code>purrr::map()</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">slide</span>(example<span class="op">$</span>x, <span class="op">~</span>.x)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co">#&gt; </span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt; </span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt; [1] 3</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#&gt; </span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt; [1] 4</span></span>
<span id="cb3-13"><a href="#cb3-13"></a></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="kw">slide</span>(example<span class="op">$</span>x, <span class="op">~</span>.x, <span class="dt">.before =</span> <span class="dv">2</span>)</span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co">#&gt; </span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co">#&gt; [1] 1 2</span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="co">#&gt; </span></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="co">#&gt; [1] 1 2 3</span></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co">#&gt; </span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="co">#&gt; [1] 2 3 4</span></span></code></pre></div>
<p>When applied to the entire <code>example</code> data frame, <code>map()</code> treats it as a list and iterates over the columns. <code>slide()</code>, on the other hand, iterates over rows. This is consistent with the vctrs idea of <em>size</em>, which is the length of an atomic vector, but the number of rows of a data frame or matrix. <code>slide()</code> always returns an object with the same size as its input. Because the number of rows in <code>example</code> is 4, the output size is 4.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">slide</span>(example, <span class="op">~</span>.x)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">#&gt;       x y    </span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt; 1     1 a    </span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt; </span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt;       x y    </span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">#&gt; 1     2 b    </span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt; </span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">#&gt;       x y    </span></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co">#&gt; 1     3 c    </span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="co">#&gt; </span></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="co">#&gt;       x y    </span></span>
<span id="cb4-23"><a href="#cb4-23"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb4-24"><a href="#cb4-24"></a><span class="co">#&gt; 1     4 d</span></span></code></pre></div>
<p>You can still use the other arguments to <code>slide()</code> to control the window size.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Current row + 2 before</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw">slide</span>(example, <span class="op">~</span>.x, <span class="dt">.before =</span> <span class="dv">2</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">#&gt;       x y    </span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt; 1     1 a    </span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt; </span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#&gt; # A tibble: 2 x 2</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt;       x y    </span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="co">#&gt; 1     1 a    </span></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="co">#&gt; 2     2 b    </span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co">#&gt; </span></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="co">#&gt; # A tibble: 3 x 2</span></span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="co">#&gt;       x y    </span></span>
<span id="cb5-19"><a href="#cb5-19"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb5-20"><a href="#cb5-20"></a><span class="co">#&gt; 1     1 a    </span></span>
<span id="cb5-21"><a href="#cb5-21"></a><span class="co">#&gt; 2     2 b    </span></span>
<span id="cb5-22"><a href="#cb5-22"></a><span class="co">#&gt; 3     3 c    </span></span>
<span id="cb5-23"><a href="#cb5-23"></a><span class="co">#&gt; </span></span>
<span id="cb5-24"><a href="#cb5-24"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb5-25"><a href="#cb5-25"></a><span class="co">#&gt; # A tibble: 3 x 2</span></span>
<span id="cb5-26"><a href="#cb5-26"></a><span class="co">#&gt;       x y    </span></span>
<span id="cb5-27"><a href="#cb5-27"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb5-28"><a href="#cb5-28"></a><span class="co">#&gt; 1     2 b    </span></span>
<span id="cb5-29"><a href="#cb5-29"></a><span class="co">#&gt; 2     3 c    </span></span>
<span id="cb5-30"><a href="#cb5-30"></a><span class="co">#&gt; 3     4 d</span></span>
<span id="cb5-31"><a href="#cb5-31"></a></span>
<span id="cb5-32"><a href="#cb5-32"></a><span class="co"># Center aligned, with no partial results</span></span>
<span id="cb5-33"><a href="#cb5-33"></a><span class="kw">slide</span>(example, <span class="op">~</span>.x, <span class="dt">.before =</span> <span class="dv">1</span>, <span class="dt">.after =</span> <span class="dv">1</span>, <span class="dt">.complete =</span> <span class="ot">TRUE</span>)</span>
<span id="cb5-34"><a href="#cb5-34"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb5-35"><a href="#cb5-35"></a><span class="co">#&gt; NULL</span></span>
<span id="cb5-36"><a href="#cb5-36"></a><span class="co">#&gt; </span></span>
<span id="cb5-37"><a href="#cb5-37"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb5-38"><a href="#cb5-38"></a><span class="co">#&gt; # A tibble: 3 x 2</span></span>
<span id="cb5-39"><a href="#cb5-39"></a><span class="co">#&gt;       x y    </span></span>
<span id="cb5-40"><a href="#cb5-40"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb5-41"><a href="#cb5-41"></a><span class="co">#&gt; 1     1 a    </span></span>
<span id="cb5-42"><a href="#cb5-42"></a><span class="co">#&gt; 2     2 b    </span></span>
<span id="cb5-43"><a href="#cb5-43"></a><span class="co">#&gt; 3     3 c    </span></span>
<span id="cb5-44"><a href="#cb5-44"></a><span class="co">#&gt; </span></span>
<span id="cb5-45"><a href="#cb5-45"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb5-46"><a href="#cb5-46"></a><span class="co">#&gt; # A tibble: 3 x 2</span></span>
<span id="cb5-47"><a href="#cb5-47"></a><span class="co">#&gt;       x y    </span></span>
<span id="cb5-48"><a href="#cb5-48"></a><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;</span></span>
<span id="cb5-49"><a href="#cb5-49"></a><span class="co">#&gt; 1     2 b    </span></span>
<span id="cb5-50"><a href="#cb5-50"></a><span class="co">#&gt; 2     3 c    </span></span>
<span id="cb5-51"><a href="#cb5-51"></a><span class="co">#&gt; 3     4 d    </span></span>
<span id="cb5-52"><a href="#cb5-52"></a><span class="co">#&gt; </span></span>
<span id="cb5-53"><a href="#cb5-53"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb5-54"><a href="#cb5-54"></a><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>Often, using <code>slide()</code> with its defaults will be enough, as its common to iterate over just one row at a time.</p>
</div>
<div id="calling-functions-with-various-parameter-combinations" class="section level2">
<h2>Calling functions with various parameter combinations</h2>
<p>A nice use of a tibble is as a structured way to store parameter combinations. For example, we could store multiple rows of parameter combinations where each row could be supplied to <code>runif()</code> to generate different types of uniform random variables.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>parameters &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="dt">n =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,</span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="dt">min =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">100</span>),</span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="dt">max =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">1000</span>)</span>
<span id="cb6-5"><a href="#cb6-5"></a>)</span>
<span id="cb6-6"><a href="#cb6-6"></a></span>
<span id="cb6-7"><a href="#cb6-7"></a>parameters</span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt; # A tibble: 3 x 3</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt;       n   min   max</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt; 1     1     0     1</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt; 2     2    10   100</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">#&gt; 3     3   100  1000</span></span></code></pre></div>
<p>With <code>slide()</code> you can pass these parameters on to <code>runif()</code> by iterating over <code>parameters</code> row-wise, giving you access to <code>.x</code> inside of the function, which is a data frame of the current row. Because it is a data frame, you have access to each column by name. Notice how there is no restriction that the columns of the data frame be the same as the argument names of <code>runif()</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="kw">slide</span>(parameters, <span class="op">~</span><span class="kw">runif</span>(.x<span class="op">$</span>n, .x<span class="op">$</span>min, .x<span class="op">$</span>max))</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">#&gt; [1] 0.2875775</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt; </span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt; [1] 80.94746 46.80792</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt; </span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">#&gt; [1] 894.7157 946.4206 141.0008</span></span></code></pre></div>
</div>
<div id="sliding-inside-a-mutate" class="section level2">
<h2>Sliding inside a mutate()</h2>
<p>For these examples, we will consider a <code>company</code> data set containing the <code>day</code> a sale was made, the number of calls, <code>n_calls</code>, that were placed on that day, and the number of <code>sales</code> that resulted from those calls.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>company &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="dt">day =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">each =</span> <span class="dv">5</span>),</span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="dt">sales =</span> <span class="kw">sample</span>(<span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="dt">n_calls =</span> sales <span class="op">+</span><span class="st"> </span><span class="kw">sample</span>(<span class="dv">1000</span>, <span class="dv">10</span>)</span>
<span id="cb8-5"><a href="#cb8-5"></a>)</span>
<span id="cb8-6"><a href="#cb8-6"></a></span>
<span id="cb8-7"><a href="#cb8-7"></a>company</span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#&gt; # A tibble: 10 x 3</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">#&gt;      day sales n_calls</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;int&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#&gt;  1     1    50    1039</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt;  2     1    43     398</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">#&gt;  3     1    14     854</span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co">#&gt;  4     1    25      51</span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co">#&gt;  5     1    90     609</span></span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="co">#&gt;  6     2    91     517</span></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="co">#&gt;  7     2    69     718</span></span>
<span id="cb8-18"><a href="#cb8-18"></a><span class="co">#&gt;  8     2    95     861</span></span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="co">#&gt;  9     2    57     268</span></span>
<span id="cb8-20"><a href="#cb8-20"></a><span class="co">#&gt; 10     2     9     941</span></span></code></pre></div>
<p>When <code>slide()</code>-ing inside of a <code>mutate()</code> call, there are a few scenarios that can arise. First, you might want to slide over a single column. This is easy enough in both the ungrouped and grouped case.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>company <span class="op">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sales_roll =</span> <span class="kw">slide_dbl</span>(sales, mean, <span class="dt">.before =</span> <span class="dv">2</span>, <span class="dt">.complete =</span> <span class="ot">TRUE</span>))</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co">#&gt; # A tibble: 10 x 4</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">#&gt;      day sales n_calls sales_roll</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;int&gt;      &lt;dbl&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt;  1     1    50    1039       NA  </span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt;  2     1    43     398       NA  </span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">#&gt;  3     1    14     854       35.7</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">#&gt;  4     1    25      51       27.3</span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co">#&gt;  5     1    90     609       43  </span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">#&gt;  6     2    91     517       68.7</span></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co">#&gt;  7     2    69     718       83.3</span></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co">#&gt;  8     2    95     861       85  </span></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="co">#&gt;  9     2    57     268       73.7</span></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="co">#&gt; 10     2     9     941       53.7</span></span>
<span id="cb9-16"><a href="#cb9-16"></a></span>
<span id="cb9-17"><a href="#cb9-17"></a>company <span class="op">%&gt;%</span></span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="st">  </span><span class="kw">group_by</span>(day) <span class="op">%&gt;%</span></span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sales_roll =</span> <span class="kw">slide_dbl</span>(sales, mean, <span class="dt">.before =</span> <span class="dv">2</span>, <span class="dt">.complete =</span> <span class="ot">TRUE</span>))</span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="co">#&gt; # A tibble: 10 x 4</span></span>
<span id="cb9-21"><a href="#cb9-21"></a><span class="co">#&gt; # Groups:   day [2]</span></span>
<span id="cb9-22"><a href="#cb9-22"></a><span class="co">#&gt;      day sales n_calls sales_roll</span></span>
<span id="cb9-23"><a href="#cb9-23"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;int&gt;      &lt;dbl&gt;</span></span>
<span id="cb9-24"><a href="#cb9-24"></a><span class="co">#&gt;  1     1    50    1039       NA  </span></span>
<span id="cb9-25"><a href="#cb9-25"></a><span class="co">#&gt;  2     1    43     398       NA  </span></span>
<span id="cb9-26"><a href="#cb9-26"></a><span class="co">#&gt;  3     1    14     854       35.7</span></span>
<span id="cb9-27"><a href="#cb9-27"></a><span class="co">#&gt;  4     1    25      51       27.3</span></span>
<span id="cb9-28"><a href="#cb9-28"></a><span class="co">#&gt;  5     1    90     609       43  </span></span>
<span id="cb9-29"><a href="#cb9-29"></a><span class="co">#&gt;  6     2    91     517       NA  </span></span>
<span id="cb9-30"><a href="#cb9-30"></a><span class="co">#&gt;  7     2    69     718       NA  </span></span>
<span id="cb9-31"><a href="#cb9-31"></a><span class="co">#&gt;  8     2    95     861       85  </span></span>
<span id="cb9-32"><a href="#cb9-32"></a><span class="co">#&gt;  9     2    57     268       73.7</span></span>
<span id="cb9-33"><a href="#cb9-33"></a><span class="co">#&gt; 10     2     9     941       53.7</span></span></code></pre></div>
<p>If the function you want to apply when sliding takes a data frame as input, things get more complicated. One way to accomplish this is by utilizing the fact that you have access to <code>.</code> in the magrittr <code>%&gt;%</code>. As an example, imagine you want to perform a rolling regression with <code>sales</code> as your outcome and <code>n_calls</code> as a predictor.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>company <span class="op">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="dt">regressions =</span> <span class="kw">slide</span>(</span>
<span id="cb10-4"><a href="#cb10-4"></a>      <span class="dt">.x =</span> ., </span>
<span id="cb10-5"><a href="#cb10-5"></a>      <span class="dt">.f =</span> <span class="op">~</span><span class="kw">lm</span>(sales <span class="op">~</span><span class="st"> </span>n_calls, .x), </span>
<span id="cb10-6"><a href="#cb10-6"></a>      <span class="dt">.before =</span> <span class="dv">2</span>, </span>
<span id="cb10-7"><a href="#cb10-7"></a>      <span class="dt">.complete =</span> <span class="ot">TRUE</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>    )</span>
<span id="cb10-9"><a href="#cb10-9"></a>  )</span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="co">#&gt; # A tibble: 10 x 4</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co">#&gt;      day sales n_calls regressions</span></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;int&gt; &lt;list&gt;     </span></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="co">#&gt;  1     1    50    1039 &lt;NULL&gt;     </span></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co">#&gt;  2     1    43     398 &lt;NULL&gt;     </span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co">#&gt;  3     1    14     854 &lt;lm&gt;       </span></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="co">#&gt;  4     1    25      51 &lt;lm&gt;       </span></span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="co">#&gt;  5     1    90     609 &lt;lm&gt;       </span></span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="co">#&gt;  6     2    91     517 &lt;lm&gt;       </span></span>
<span id="cb10-19"><a href="#cb10-19"></a><span class="co">#&gt;  7     2    69     718 &lt;lm&gt;       </span></span>
<span id="cb10-20"><a href="#cb10-20"></a><span class="co">#&gt;  8     2    95     861 &lt;lm&gt;       </span></span>
<span id="cb10-21"><a href="#cb10-21"></a><span class="co">#&gt;  9     2    57     268 &lt;lm&gt;       </span></span>
<span id="cb10-22"><a href="#cb10-22"></a><span class="co">#&gt; 10     2     9     941 &lt;lm&gt;</span></span></code></pre></div>
<p>But here be dragons! The <code>.</code> you have access to has two problems.</p>
<div id="no-updating-as-you-add-new-columns." class="section level3">
<h3>No updating as you add new columns.</h3>
<p>If you try and add columns in the <code>mutate()</code> and expect them to be available to you in <code>.</code>, you will be upset. In this case, <code>lm()</code> couldn’t find <code>log_n_calls</code> in the slice of <code>.</code> available through <code>.x</code>, so it looked in the surrounding environment and found the entire length 10 <code>log_n_calls</code> vector that we created and tried to pass that through to the regression.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>company <span class="op">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="dt">log_n_calls =</span> <span class="kw">log</span>(n_calls),</span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="dt">regressions =</span> <span class="kw">slide</span>(</span>
<span id="cb11-5"><a href="#cb11-5"></a>      <span class="dt">.x =</span> ., </span>
<span id="cb11-6"><a href="#cb11-6"></a>      <span class="dt">.f =</span> <span class="op">~</span><span class="kw">lm</span>(sales <span class="op">~</span><span class="st"> </span>log_n_calls, .x), </span>
<span id="cb11-7"><a href="#cb11-7"></a>      <span class="dt">.before =</span> <span class="dv">2</span>, </span>
<span id="cb11-8"><a href="#cb11-8"></a>      <span class="dt">.complete =</span> <span class="ot">TRUE</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>    )</span>
<span id="cb11-10"><a href="#cb11-10"></a>  )</span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">#&gt; Error in model.frame.default(formula = sales ~ log_n_calls, data = .x, : variable lengths differ (found for &#39;log_n_calls&#39;)</span></span></code></pre></div>
<p>To show this a bit simpler, let’s just try and access that <code>log_n_calls</code> column inside our slide function. We immediately get a slew of warnings because it doesn’t exist.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>company <span class="op">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb12-3"><a href="#cb12-3"></a>    <span class="dt">log_n_calls =</span> <span class="kw">log</span>(n_calls),</span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="dt">example =</span> <span class="kw">slide</span>(., <span class="op">~</span>.x<span class="op">$</span>log_n_calls)</span>
<span id="cb12-5"><a href="#cb12-5"></a>  )</span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="co">#&gt; Warning: Unknown or uninitialised column: &#39;log_n_calls&#39;.</span></span>
<span id="cb12-7"><a href="#cb12-7"></a></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="co">#&gt; Warning: Unknown or uninitialised column: &#39;log_n_calls&#39;.</span></span>
<span id="cb12-9"><a href="#cb12-9"></a></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="co">#&gt; Warning: Unknown or uninitialised column: &#39;log_n_calls&#39;.</span></span>
<span id="cb12-11"><a href="#cb12-11"></a></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="co">#&gt; Warning: Unknown or uninitialised column: &#39;log_n_calls&#39;.</span></span>
<span id="cb12-13"><a href="#cb12-13"></a></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="co">#&gt; Warning: Unknown or uninitialised column: &#39;log_n_calls&#39;.</span></span>
<span id="cb12-15"><a href="#cb12-15"></a></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="co">#&gt; Warning: Unknown or uninitialised column: &#39;log_n_calls&#39;.</span></span>
<span id="cb12-17"><a href="#cb12-17"></a></span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="co">#&gt; Warning: Unknown or uninitialised column: &#39;log_n_calls&#39;.</span></span>
<span id="cb12-19"><a href="#cb12-19"></a></span>
<span id="cb12-20"><a href="#cb12-20"></a><span class="co">#&gt; Warning: Unknown or uninitialised column: &#39;log_n_calls&#39;.</span></span>
<span id="cb12-21"><a href="#cb12-21"></a></span>
<span id="cb12-22"><a href="#cb12-22"></a><span class="co">#&gt; Warning: Unknown or uninitialised column: &#39;log_n_calls&#39;.</span></span>
<span id="cb12-23"><a href="#cb12-23"></a></span>
<span id="cb12-24"><a href="#cb12-24"></a><span class="co">#&gt; Warning: Unknown or uninitialised column: &#39;log_n_calls&#39;.</span></span>
<span id="cb12-25"><a href="#cb12-25"></a><span class="co">#&gt; # A tibble: 10 x 5</span></span>
<span id="cb12-26"><a href="#cb12-26"></a><span class="co">#&gt;      day sales n_calls log_n_calls example</span></span>
<span id="cb12-27"><a href="#cb12-27"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;int&gt;       &lt;dbl&gt; &lt;list&gt; </span></span>
<span id="cb12-28"><a href="#cb12-28"></a><span class="co">#&gt;  1     1    50    1039        6.95 &lt;NULL&gt; </span></span>
<span id="cb12-29"><a href="#cb12-29"></a><span class="co">#&gt;  2     1    43     398        5.99 &lt;NULL&gt; </span></span>
<span id="cb12-30"><a href="#cb12-30"></a><span class="co">#&gt;  3     1    14     854        6.75 &lt;NULL&gt; </span></span>
<span id="cb12-31"><a href="#cb12-31"></a><span class="co">#&gt;  4     1    25      51        3.93 &lt;NULL&gt; </span></span>
<span id="cb12-32"><a href="#cb12-32"></a><span class="co">#&gt;  5     1    90     609        6.41 &lt;NULL&gt; </span></span>
<span id="cb12-33"><a href="#cb12-33"></a><span class="co">#&gt;  6     2    91     517        6.25 &lt;NULL&gt; </span></span>
<span id="cb12-34"><a href="#cb12-34"></a><span class="co">#&gt;  7     2    69     718        6.58 &lt;NULL&gt; </span></span>
<span id="cb12-35"><a href="#cb12-35"></a><span class="co">#&gt;  8     2    95     861        6.76 &lt;NULL&gt; </span></span>
<span id="cb12-36"><a href="#cb12-36"></a><span class="co">#&gt;  9     2    57     268        5.59 &lt;NULL&gt; </span></span>
<span id="cb12-37"><a href="#cb12-37"></a><span class="co">#&gt; 10     2     9     941        6.85 &lt;NULL&gt;</span></span></code></pre></div>
</div>
<div id="no-respect-of-groups" class="section level3">
<h3>No respect of groups</h3>
<p>Even if you don’t create new columns in your <code>mutate()</code>, there is a high chance that you’ll use dplyr for its <code>group_by()</code> capability. If you try and use <code>.</code> with a grouped data frame, you’ll have issues as well because <code>.</code> won’t correspond to the <em>current group</em>, but will instead be the <em>entire data frame</em>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>company <span class="op">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="st">  </span><span class="kw">group_by</span>(day) <span class="op">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb13-4"><a href="#cb13-4"></a>    <span class="dt">regressions =</span> <span class="kw">slide</span>(</span>
<span id="cb13-5"><a href="#cb13-5"></a>      <span class="dt">.x =</span> ., </span>
<span id="cb13-6"><a href="#cb13-6"></a>      <span class="dt">.f =</span> <span class="op">~</span><span class="kw">lm</span>(sales <span class="op">~</span><span class="st"> </span>n_calls, .x), </span>
<span id="cb13-7"><a href="#cb13-7"></a>      <span class="dt">.before =</span> <span class="dv">2</span>, </span>
<span id="cb13-8"><a href="#cb13-8"></a>      <span class="dt">.complete =</span> <span class="ot">TRUE</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>    )</span>
<span id="cb13-10"><a href="#cb13-10"></a>  )</span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co">#&gt; Error: Column `regressions` must be length 5 (the group size) or one, not 10</span></span></code></pre></div>
</div>
<div id="solution-sort-of" class="section level3">
<h3>Solution (sort of)</h3>
<p>The “problem” is that currently dplyr does not give us any way to easily access the current data frame that we are processing. We can access individual columns by name, but the entire data frame object is impossible to get access to. I’m optimistic that this will get easier in the coming months, but in the mean time here are a few solutions that you can use.</p>
<p>Rather than trying to pass the data frame on with <code>.</code>, you can construct it on the fly from the individual vectors that you do have access to. This means you would have access to any columns that were created in the same <code>mutate()</code> call.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>company <span class="op">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="dt">log_n_calls =</span> <span class="kw">log</span>(n_calls),</span>
<span id="cb14-4"><a href="#cb14-4"></a>    <span class="dt">regressions =</span> <span class="kw">slide</span>(</span>
<span id="cb14-5"><a href="#cb14-5"></a>      <span class="dt">.x =</span> <span class="kw">tibble</span>(<span class="dt">sales =</span> sales, <span class="dt">log_n_calls =</span> log_n_calls), </span>
<span id="cb14-6"><a href="#cb14-6"></a>      <span class="dt">.f =</span> <span class="op">~</span><span class="kw">lm</span>(sales <span class="op">~</span><span class="st"> </span>log_n_calls, .x), </span>
<span id="cb14-7"><a href="#cb14-7"></a>      <span class="dt">.before =</span> <span class="dv">2</span>, </span>
<span id="cb14-8"><a href="#cb14-8"></a>      <span class="dt">.complete =</span> <span class="ot">TRUE</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>    )</span>
<span id="cb14-10"><a href="#cb14-10"></a>  )</span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="co">#&gt; # A tibble: 10 x 5</span></span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="co">#&gt;      day sales n_calls log_n_calls regressions</span></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;int&gt;       &lt;dbl&gt; &lt;list&gt;     </span></span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="co">#&gt;  1     1    50    1039        6.95 &lt;NULL&gt;     </span></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="co">#&gt;  2     1    43     398        5.99 &lt;NULL&gt;     </span></span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="co">#&gt;  3     1    14     854        6.75 &lt;lm&gt;       </span></span>
<span id="cb14-17"><a href="#cb14-17"></a><span class="co">#&gt;  4     1    25      51        3.93 &lt;lm&gt;       </span></span>
<span id="cb14-18"><a href="#cb14-18"></a><span class="co">#&gt;  5     1    90     609        6.41 &lt;lm&gt;       </span></span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="co">#&gt;  6     2    91     517        6.25 &lt;lm&gt;       </span></span>
<span id="cb14-20"><a href="#cb14-20"></a><span class="co">#&gt;  7     2    69     718        6.58 &lt;lm&gt;       </span></span>
<span id="cb14-21"><a href="#cb14-21"></a><span class="co">#&gt;  8     2    95     861        6.76 &lt;lm&gt;       </span></span>
<span id="cb14-22"><a href="#cb14-22"></a><span class="co">#&gt;  9     2    57     268        5.59 &lt;lm&gt;       </span></span>
<span id="cb14-23"><a href="#cb14-23"></a><span class="co">#&gt; 10     2     9     941        6.85 &lt;lm&gt;</span></span></code></pre></div>
<p>This also works for the grouped example.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>company <span class="op">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="st">  </span><span class="kw">group_by</span>(day) <span class="op">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="dt">regressions =</span> <span class="kw">slide</span>(</span>
<span id="cb15-5"><a href="#cb15-5"></a>      <span class="dt">.x =</span> <span class="kw">tibble</span>(<span class="dt">sales =</span> sales, <span class="dt">n_calls =</span> n_calls), </span>
<span id="cb15-6"><a href="#cb15-6"></a>      <span class="dt">.f =</span> <span class="op">~</span><span class="kw">lm</span>(sales <span class="op">~</span><span class="st"> </span>n_calls, .x), </span>
<span id="cb15-7"><a href="#cb15-7"></a>      <span class="dt">.before =</span> <span class="dv">2</span>, </span>
<span id="cb15-8"><a href="#cb15-8"></a>      <span class="dt">.complete =</span> <span class="ot">TRUE</span></span>
<span id="cb15-9"><a href="#cb15-9"></a>    )</span>
<span id="cb15-10"><a href="#cb15-10"></a>  )</span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="co">#&gt; # A tibble: 10 x 4</span></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="co">#&gt; # Groups:   day [2]</span></span>
<span id="cb15-13"><a href="#cb15-13"></a><span class="co">#&gt;      day sales n_calls regressions</span></span>
<span id="cb15-14"><a href="#cb15-14"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;int&gt; &lt;list&gt;     </span></span>
<span id="cb15-15"><a href="#cb15-15"></a><span class="co">#&gt;  1     1    50    1039 &lt;NULL&gt;     </span></span>
<span id="cb15-16"><a href="#cb15-16"></a><span class="co">#&gt;  2     1    43     398 &lt;NULL&gt;     </span></span>
<span id="cb15-17"><a href="#cb15-17"></a><span class="co">#&gt;  3     1    14     854 &lt;lm&gt;       </span></span>
<span id="cb15-18"><a href="#cb15-18"></a><span class="co">#&gt;  4     1    25      51 &lt;lm&gt;       </span></span>
<span id="cb15-19"><a href="#cb15-19"></a><span class="co">#&gt;  5     1    90     609 &lt;lm&gt;       </span></span>
<span id="cb15-20"><a href="#cb15-20"></a><span class="co">#&gt;  6     2    91     517 &lt;NULL&gt;     </span></span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="co">#&gt;  7     2    69     718 &lt;NULL&gt;     </span></span>
<span id="cb15-22"><a href="#cb15-22"></a><span class="co">#&gt;  8     2    95     861 &lt;lm&gt;       </span></span>
<span id="cb15-23"><a href="#cb15-23"></a><span class="co">#&gt;  9     2    57     268 &lt;lm&gt;       </span></span>
<span id="cb15-24"><a href="#cb15-24"></a><span class="co">#&gt; 10     2     9     941 &lt;lm&gt;</span></span></code></pre></div>
<p>Depending on your comfort with the new <code>dplyr::group_modify()</code> function, it can provide a solution that doesn’t require you to explicitly create a tibble of the columns you require. <code>group_modify()</code> allows us to apply a function on each group, giving us access to the current data frame as the first argument to the function, and the “key” as the second argument. We don’t need to worry about the key for this example, but we need to “swallow” it with <code>...</code> in our function.</p>
<p>The way I tackle these problems is to construct a function that works on one data frame group, then apply it to all of them.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>single_group_regressions &lt;-<span class="st"> </span><span class="cf">function</span>(.data_group, ...) {</span>
<span id="cb16-2"><a href="#cb16-2"></a>  regressions &lt;-<span class="st"> </span><span class="kw">slide</span>(</span>
<span id="cb16-3"><a href="#cb16-3"></a>      <span class="dt">.x =</span> .data_group, </span>
<span id="cb16-4"><a href="#cb16-4"></a>      <span class="dt">.f =</span> <span class="op">~</span><span class="kw">lm</span>(sales <span class="op">~</span><span class="st"> </span>n_calls, .x), </span>
<span id="cb16-5"><a href="#cb16-5"></a>      <span class="dt">.before =</span> <span class="dv">2</span>, </span>
<span id="cb16-6"><a href="#cb16-6"></a>      <span class="dt">.complete =</span> <span class="ot">TRUE</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>    )</span>
<span id="cb16-8"><a href="#cb16-8"></a>  </span>
<span id="cb16-9"><a href="#cb16-9"></a>  <span class="kw">mutate</span>(.data_group, <span class="dt">regressions =</span> regressions)</span>
<span id="cb16-10"><a href="#cb16-10"></a>}</span></code></pre></div>
<p>Test it on one group.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>day_one &lt;-<span class="st"> </span><span class="kw">filter</span>(company, day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="kw">single_group_regressions</span>(day_one)</span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="co">#&gt; # A tibble: 5 x 4</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co">#&gt;     day sales n_calls regressions</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt;   &lt;int&gt; &lt;list&gt;     </span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="co">#&gt; 1     1    50    1039 &lt;NULL&gt;     </span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="co">#&gt; 2     1    43     398 &lt;NULL&gt;     </span></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="co">#&gt; 3     1    14     854 &lt;lm&gt;       </span></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="co">#&gt; 4     1    25      51 &lt;lm&gt;       </span></span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="co">#&gt; 5     1    90     609 &lt;lm&gt;</span></span></code></pre></div>
<p>Now apply it to all groups with <code>group_modify()</code>!</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>company <span class="op">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="st">  </span><span class="kw">group_by</span>(day) <span class="op">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="st">  </span><span class="kw">group_modify</span>(single_group_regressions)</span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co">#&gt; # A tibble: 10 x 4</span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co">#&gt; # Groups:   day [2]</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="co">#&gt;      day sales n_calls regressions</span></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;int&gt; &lt;list&gt;     </span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="co">#&gt;  1     1    50    1039 &lt;NULL&gt;     </span></span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="co">#&gt;  2     1    43     398 &lt;NULL&gt;     </span></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="co">#&gt;  3     1    14     854 &lt;lm&gt;       </span></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="co">#&gt;  4     1    25      51 &lt;lm&gt;       </span></span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="co">#&gt;  5     1    90     609 &lt;lm&gt;       </span></span>
<span id="cb18-13"><a href="#cb18-13"></a><span class="co">#&gt;  6     2    91     517 &lt;NULL&gt;     </span></span>
<span id="cb18-14"><a href="#cb18-14"></a><span class="co">#&gt;  7     2    69     718 &lt;NULL&gt;     </span></span>
<span id="cb18-15"><a href="#cb18-15"></a><span class="co">#&gt;  8     2    95     861 &lt;lm&gt;       </span></span>
<span id="cb18-16"><a href="#cb18-16"></a><span class="co">#&gt;  9     2    57     268 &lt;lm&gt;       </span></span>
<span id="cb18-17"><a href="#cb18-17"></a><span class="co">#&gt; 10     2     9     941 &lt;lm&gt;</span></span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
